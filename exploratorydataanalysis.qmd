---
title: " Exploratory Data Analysis"
date: "2023-12-14"
format: 
  html:
    code-fold: true
    code-tools: true
---

## Introduction: Exploratory Data Analysis on WITS data

World Integrated Trade Solution (WITS) emerges as a pivotal platform, offering a comprehensive view of international trade dynamics, with a particular focus on Turkey from 2002 to 2020. This powerful tool aggregates data from diverse sources to furnish users with valuable insights into Turkey's merchandise trade, tariffs, and non-tariff measures during this specific period. With an expansive database, WITS facilitates informed decision-making and strategic planning for researchers, policymakers, and businesses interested in Turkey's trade landscape.

Embarking on an Exploratory Data Analysis (EDA) journey within WITS involves loading datasets, cleaning data, and employing statistical and visual analyses specific to Turkey's trade from 2002 to 2020. This process unveils trade patterns, identifies trends, and provides actionable insights, enabling stakeholders to navigate the complexities of Turkey's trade dynamics during this crucial timeframe. The synergy between WITS and EDA empowers users to make informed decisions and strategic choices, fostering a more interconnected and informed landscape for Turkey's economy and trade.

------------------------------------------------------------------------

## Step 1: Load Required Libraries

```{r}

library(tidyverse)
library(dplyr)
library(ggplot2)
library(RColorBrewer)
library(ggridges)
library(knitr)
library(kableExtra)
library(DT)

```

Description: Loading necessary libraries provides access to functions and tools that simplify data manipulation and visualization. dplyr is helpful for data wrangling, and ggplot2 is excellent for creating informative and visually appealing plots.

## Step 2: Load Datasets

```{r}
# Load the datasets
loaded_datasets <- readRDS("wits_data.rds")
read_wits_turkey_data_only <- loaded_datasets$wits_turkey_data_only
read_wits_turkey_data_with_partners <- loaded_datasets$wits_turkey_data_with_partners
read_wits_all_country_data <- loaded_datasets$wits_all_country_data
```

Description: Loading datasets is the initial step in any data analysis. It allows us to bring in the data that we'll be working with throughout the analysis.

## Step 3: Overview of the Datasets

```{r}
str(read_wits_turkey_data_only)
summary(read_wits_turkey_data_only)

str(read_wits_turkey_data_with_partners)
summary(read_wits_turkey_data_with_partners)

str(read_wits_all_country_data)
summary(read_wits_all_country_data)
```

Description: Checking the structure and summary of the datasets provides an understanding of the variables, data types, and basic statistics. This helps identify potential issues and informs subsequent cleaning and analysis steps.

## Step 4: Data Cleaning

```{r message=FALSE,warning=FALSE}
sapply(read_wits_turkey_data_only, function(x) sum(is.na(x)))

# will be done

```

Description: Cleaning the data involves addressing missing values and outliers. It ensures that the data is reliable and ready for further analysis.

## Step 5: Exploratory Data Analysis (EDA)

### Country Profile

|                            |     |
|----------------------------|-----|
| **Export Ranking:**        |     |
| **Import Ranking:**        |     |
| **Top Trading Partners**:  |     |

*Most available data is as of 2020 year-end:*

```{r}
#Calculate Country Profile Stats

```

**Line Chart: Exports and Imports over the Years:**

```{r message=FALSE,warning=FALSE}
total_exports <- read_wits_turkey_data_only %>%
  group_by(year) %>%
  summarize(total_exports = sum(trade_value_usd_exp))

total_imports <- read_wits_turkey_data_only %>%
  group_by(year) %>%
  summarize(total_imports = sum(trade_value_usd_imp))

# Visualize exports and imports over the years
ggplot() +
  geom_line(data = total_exports, aes(x = year, y = total_exports, color = "Exports"), size = 1.5) +
  geom_line(data = total_imports, aes(x = year, y = total_imports, color = "Imports"), size = 1.5) +
  labs(title = "Turkey's Exports and Imports Over the Years", x = "Year", y = "Trade Value (USD)"
)
```

*Line Chart Description: Analyzing exports and imports over time provides insights into the trade trends of the country. Visualization helps in identifying patterns and understanding the overall trade dynamics*

**Result: Turkey's status is as a net importer since 2002**

### Exports & Imports Analysis

**Top 10 product categories are listed in this section both for exports and imports in order to analyze this further by looking into trade partners of these product types**

**Clustered Column Chart: Diversity of Exported Products**

```{r message=FALSE,warning=FALSE}
export_plot_data <- read_wits_turkey_data_only %>%
  group_by(section_name) %>%
  summarize(total_export = sum(trade_value_usd_exp)) %>%
  top_n(10)

# Truncate section names to the first 20 characters
export_plot_data$truncated_name <- str_trunc(export_plot_data$section_name, 50)

# Get distinct truncated names for colors
color_names <- unique(export_plot_data$truncated_name)

# Generate a limited number of distinct colors
colors <- brewer.pal(length(color_names), "Set3")

ggplot(data = export_plot_data, aes(x = reorder(section_name, -total_export), y = total_export, fill = truncated_name)) +
  geom_bar(stat = "identity", color = "black") +
  labs(title = "Top 10 Diversity of Exported Products (2002-2020, Turkey)", x = "Products", y = "Total Export Value (USD)") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), legend.position = "bottom") +
  guides(fill = guide_legend(nrow = 5)) +
  scale_fill_manual(values = setNames(colors, color_names), name = "")

```

*Chart Description:The "Diversity of Exported Products" graphic provides insights into Turkey's international trade from 2002 to 2020. It showcases the top 10 product categories that Turkey has predominantly exported over the years. Each product category is represented by a distinct color, offering a visual representation of the diversity and distribution of exported goods. The vertical bars display the total export values in USD for each product category, providing a clear overview of Turkey's major export sectors. The graphic aids in identifying trends, patterns, and the relative significance of various product categories in Turkey's export landscape.*

**Bubble Chart: Relationship between Complexity and Annual Export Growth (CAGR Last 5 years) for Top Product Categories**

```{r message=FALSE,warning=FALSE}

# Step 1: Find the top 10 section_name based on trade_value
top_sections <- read_wits_turkey_data_with_partners %>%
  group_by(section_name) %>%
  summarize(total_export = sum(trade_value_usd_exp)) %>%
  arrange(desc(total_export)) %>%
  head(10)

# Step 2: Filter the dataframe to include only the top 10 section_names
read_wits_turkey_data_with_partners_top10 <- read_wits_turkey_data_with_partners %>%
  filter(section_name %in% top_sections$section_name)

# Step 3: Count partner_names corresponding to the top 10 section_names in the entire dataframe
read_wits_turkey_data_with_partners_top10  <- read_wits_turkey_data_with_partners_top10  %>%
  group_by(section_name) %>%
  mutate(partner_count = n_distinct(partner_name)) %>%
  ungroup()

read_wits_turkey_data_with_partners_top10 <- read_wits_turkey_data_with_partners_top10 %>%
  group_by(section_name) %>%
  mutate(cagr = ((trade_value_usd_exp[2020]/trade_value_usd_exp[2015])^(1/5)-1)*100) %>%
  ungroup()

read_wits_turkey_data_with_partners_top10 <- read_wits_turkey_data_with_partners_top10 %>%
  filter(year == 2020) %>%
  group_by(section_name) %>%
  mutate(total_trade_value_exp_2020 = sum(trade_value_usd_exp)/1000000) %>%
  ungroup()

print(read_wits_turkey_data_with_partners_top10)

# Truncate section names to the first 20 characters
read_wits_turkey_data_with_partners_top10$truncated_name <- str_trunc(read_wits_turkey_data_with_partners_top10$section_name, 50)

# Get distinct truncated names for colors
color_names <- read_wits_turkey_data_with_partners_top10$truncated_name


ggplot(read_wits_turkey_data_with_partners_top10, aes(x = partner_count, y = total_trade_value_exp_2020, size = cagr, color = truncated_name)) +
  geom_point(alpha = 0.7) +
  scale_size_continuous(range = c(3, 15)) +
  scale_y_continuous(limits = c(min(read_wits_turkey_data_with_partners_top10$total_trade_value_exp_2020), max(read_wits_turkey_data_with_partners_top10$total_trade_value_exp_2020) + 5)) + # adjust y-axis scale
  scale_x_continuous(limits = c(min(read_wits_turkey_data_with_partners_top10$partner_count), max(read_wits_turkey_data_with_partners_top10$partner_count) + 5)) +  # adjust x-axis scale
  scale_color_manual(values = scales::hue_pal()(length(unique(read_wits_turkey_data_with_partners_top10$section_name)))) +  # Use a different color palette
  labs(title = "Bubble Chart of Top 10 Section Names",
       x = "Number of Export Countries",
       y = "Total Export Revenue mn USD (2020) ",
       size = "5 year CAGR", 
       color = "Section Name") +
    theme_minimal ()
```

*Chart Description: Complexity represents count of Turkey's export partners for each product category that are defined in Analysis of Diversity of Exported Products, that are shown on x axis. Compounded growth rates of exports are represented on y axis. Each bubble represents exports value as of 2020 for each product category.*

**Clustered Column Chart: Diversity of Imported Products**

```{r message=FALSE,warning=FALSE}
imported_plot_data <- read_wits_turkey_data_only %>%
  group_by(section_name) %>%
  summarize(total_import = sum(trade_value_usd_imp)) %>%
  top_n(10)

# Truncate section names to the first 20 characters
imported_plot_data$truncated_name <- str_trunc(imported_plot_data$section_name, 50)

# Get distinct truncated names for colors
color_names <- unique(imported_plot_data$truncated_name)

# Generate a limited number of distinct colors
colors <- brewer.pal(length(color_names), "Set3")

ggplot(data = imported_plot_data, aes(x = reorder(section_name, -total_import), y = total_import, fill = truncated_name)) +
  geom_bar(stat = "identity", color = "black") +
  labs(title = "Top 10 Diversity of Imported Products (2002-2020, Turkey)", x = "Products", y = "Total Import Value (USD)") +
  theme(axis.text.x = element_blank(), axis.title.x = element_blank(), legend.position = "bottom") +
  guides(fill = guide_legend(nrow = 5)) +
  scale_fill_manual(values = setNames(colors, color_names), name = "")

```

*Chart Description: The "Diversity of Imported Products" graphic illustrates the diversity of products that Turkey has imported from other countries between 2002 and 2020. Similar to the exported products graphic, this visualization highlights the top 10 imported product categories. Each category is uniquely colored for easy identification. The vertical bars display the total import values in USD for each product category, offering insights into the composition of Turkey's imports. This graphic assists in understanding the import dynamics, identifying significant product categories, and discerning patterns in Turkey's international trade relationships.*

**Bubble Chart: Relationship between Complexity and Annual Import Growth (CAGR Last 5 years) for Top Product Categories**

```{r message=FALSE,warning=FALSE}

# Step 1: Find the top 10 section_name based on trade_value
top_sections <- read_wits_turkey_data_with_partners %>%
  group_by(section_name) %>%
  summarize(total_import = sum(trade_value_usd_imp)) %>%
  arrange(desc(total_import)) %>%
  head(10)

# Step 2: Filter the dataframe to include only the top 10 section_names
read_wits_turkey_data_with_partners_top10 <- read_wits_turkey_data_with_partners %>%
  filter(section_name %in% top_sections$section_name)

# Step 3: Count partner_names corresponding to the top 10 section_names in the entire dataframe
read_wits_turkey_data_with_partners_top10  <- read_wits_turkey_data_with_partners_top10  %>%
  group_by(section_name) %>%
  mutate(partner_count = n_distinct(partner_name)) %>%
  ungroup()

read_wits_turkey_data_with_partners_top10 <- read_wits_turkey_data_with_partners_top10 %>%
  group_by(section_name) %>%
  mutate(cagr = ((trade_value_usd_imp[2020]/trade_value_usd_imp[2015])^(1/5)-1)*100) %>%
  ungroup()

read_wits_turkey_data_with_partners_top10 <- read_wits_turkey_data_with_partners_top10 %>%
  filter(year == 2020) %>%
  group_by(section_name) %>%
  mutate(total_trade_value_imp_2020 = sum(trade_value_usd_imp)/1000000) %>%
  ungroup()

print(read_wits_turkey_data_with_partners_top10)

# Truncate section names to the first 50 characters
read_wits_turkey_data_with_partners_top10$truncated_name <- str_trunc(read_wits_turkey_data_with_partners_top10$section_name, 50)

# Get distinct truncated names for colors
color_names <- read_wits_turkey_data_with_partners_top10$truncated_name


ggplot(read_wits_turkey_data_with_partners_top10, aes(x = partner_count, y = total_trade_value_imp_2020, size = cagr, color = truncated_name)) +
  geom_point(alpha = 0.7) +
  scale_size_continuous(range = c(3, 15)) +
  scale_y_continuous(limits = c(min(read_wits_turkey_data_with_partners_top10$total_trade_value_imp_2020), max(read_wits_turkey_data_with_partners_top10$total_trade_value_imp_2020) + 5)) + # adjust y-axis scale
  scale_x_continuous(limits = c(min(read_wits_turkey_data_with_partners_top10$partner_count), max(read_wits_turkey_data_with_partners_top10$partner_count) + 5)) +  # adjust x-axis scale
  scale_color_manual(values = scales::hue_pal()(length(unique(read_wits_turkey_data_with_partners_top10$section_name)))) +  # Use a different color palette
  labs(title = "Bubble Chart of Top 10 Section Names",
       x = "Number of Importers",
       y = "Total Import mn USD (2020) ",
       size = "5 year CAGR", 
       color = "Section Name") +
    theme_minimal ()
```

*Chart Description: Complexity represents count of Turkey's import partners for each product category that are defined in Analysis of Diversity of Imported Products, that are shown on x axis. Compounded growth rates of imports are represented on y axis. Each bubble represents exports value as of 2020 for each product category.*

### Trade Partnership Analysis

**Clustered Column Chart: Top 10 Trading Partners by Total Trade Value**

```{r message=FALSE,warning=FALSE}
top_partners <- read_wits_turkey_data_with_partners %>%
  group_by(partner_name) %>%
  summarize(total_trade = sum(trade_value_usd_exp + trade_value_usd_imp)) %>%
  arrange(desc(total_trade)) %>%
  top_n(10)

# Get a color palette from RColorBrewer
partner_colors <- brewer.pal(length(top_partners$partner_name), "Set3")

# Visualize top trading partners
ggplot(data = top_partners, aes(x = reorder(partner_name, -total_trade), y = total_trade, fill = partner_name)) +
  geom_bar(stat = "identity", color = "black") +
  labs(title = "Top 10 Trading Partners", x = "Partner", y = "Total Trade Value (USD)") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  scale_fill_manual(values = partner_colors)+
  theme(legend.position = "none")
```

*Chart Description: Analyzing trade with specific partners helps in identifying key collaborators. Visualizing the top trading partners provides a clear understanding of the major contributors to the country's trade.*

**Clustered Column Chart: Trade Partner Classification as Net Exporter or Importer**

```{r message=FALSE,warning=FALSE}
# Calculate total trade for each partner
partners <- read_wits_turkey_data_with_partners %>%
  group_by(partner_name) %>%
  summarize(total_trade = sum(trade_value_usd_exp + trade_value_usd_imp)) %>%
  arrange(desc(total_trade)) %>%
  top_n(10)

# Calculate total export and import for each top partner
top_partners <- read_wits_turkey_data_with_partners %>%
  filter(partner_name %in% partners$partner_name) %>%
  group_by(partner_name) %>%
  summarize(total_export = sum(trade_value_usd_exp),
            total_import = sum(trade_value_usd_imp)) %>%
  arrange(desc(total_export + total_import)) %>%
  top_n(10)%>%
  na.omit() 

# Calculate the net difference
top_partners <- top_partners %>%
  mutate(trade_difference = total_export - total_import)%>%
  na.omit() 


# Visualize import and export relations with top trading partners
ggplot(data = top_partners, aes(x = reorder(partner_name, -total_export - total_import))) +
  geom_bar(aes(y = total_export, fill = "Export"), stat = "identity", position = "dodge",color = "darkgray", linetype = "dashed" ) +
  geom_bar(aes(y = -total_import, fill = "Import"), stat = "identity", position = "dodge",color = "darkgray", linetype = "dashed") +
  geom_bar(aes(y = trade_difference, fill = factor(sign(trade_difference))),
           stat = "identity", position = "dodge", color = "black", alpha=0.7) +
  labs(title = "Import and Export Relations with Top 10 Trading Partners",
       x = "Partner", y = "Total Trade Value (USD)") +
  scale_fill_manual(values = c("Export" = "gray", "Import" = "lightgray",
                                "1" = "skyblue3", "-1" = "lightcoral"),
                    name = "",
                    labels = c("Turkey net importer", "Turkey net exporter", "Import", "Export")) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position = "top")
```
*Chart Description:This chart illustrates the overall trade difference by summing the 'trade_difference' values for all top trading partners and then generates a text description based on whether Turkey was a net exporter or importer.*

**Clustered Column Chart: Net Trade Difference with Top 10 Trading Partners between 2015 and 2020**
```{r message=FALSE,warning=FALSE}

# Vector of countries to filter
selected_countries <- c("Germany", "Russian Federation", "China", "Italy", "USA", "United Kingdom", "France", "Spain", "Iran", "Iraq")

top_partners <- read_wits_turkey_data_with_partners %>%
  filter(partner_name %in% selected_countries, year %in% 2015:2020) %>%
  group_by(partner_name, year) %>%
  summarize(total_export = sum(trade_value_usd_exp),
            total_import = sum(trade_value_usd_imp)) %>%
  mutate(trade_difference = total_export - total_import)


# Create a bar plot to show trade comparison with selected trading partners
ggplot(data = top_partners, aes(x = reorder(partner_name, -trade_difference), y = trade_difference/1000000, fill = factor(sign(trade_difference)))) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), color = "black", height = 1.5) +  # Adjust the 'height' parameter
  facet_wrap(~year, scales = "free_y", ncol = 3) +
  scale_fill_manual(values = c("lightcoral", "skyblue3"), name = "",
                    labels = c("Turkey net importer", "Turkey net exporter")) +
  labs(title = "Trade Comparison with Top 10 Trading Partners(2015-2020)",
       x = "Partner",
       y = "Trade Difference (Export - Import, mn USD)") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position = "top")
```
*Chart Description: This bar plot illustrates the import and export relations between Turkey and its top 10 trading partners. Bars shows Turkey's net importer & exporter status as each of them corresponds to a specific partner, and positive figures represent Turkey's status as net exporter while negative figures represent net importer. The plot offers a concise overview of Turkey's trade dynamics with its key partners, emphasizing the balance of trade and highlighting significant trading relationships. *

**Lollipop Chart: Trend Analysis of Top 10 Trading Partners' trade value**

```{r message=FALSE,warning=FALSE}

# Replace "YourFirstYear" and "YourEndYear" with the actual years that is selected for the analysis
first_year <- 2015
end_year <- 2020

# Calculate the total trade value for the first and end years for each partner
total_trade_by_partner <- read_wits_turkey_data_with_partners %>%
  group_by(partner_name) %>%
  summarise(total_trade_first = sum(trade_value_usd_imp[year == first_year] + trade_value_usd_exp[year == first_year]),
            total_trade_end = sum(trade_value_usd_imp[year == end_year] + trade_value_usd_exp[year == end_year]))

# Find the top 10 partners based on the total trade value
top_10_partners <- total_trade_by_partner %>%
  top_n(10, wt = total_trade_end)

# Calculate the percentage change
percentage_change <- top_10_partners %>%
  mutate(percentage_change = ((total_trade_end - total_trade_first) / total_trade_first) * 100)

# Create a lollipop chart
ggplot(percentage_change, aes(x = reorder(partner_name, percentage_change), y = percentage_change)) +
  geom_segment(aes(xend = reorder(partner_name, percentage_change), yend = 0), color = "skyblue", size = 1) +
  geom_point(color = "red", size = 3) +
  labs(title = "Top 10 Partners: Percentage Change in Total Trade Value (2015 to 2020)",
       x = "Partner",
       y = "Percentage Change in Total Trade Value") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

*Chart Description: This lollipop chart illustrates 5 year trade value (total import + export) change between Turkey and its top 10 trading partners. Positive bars represent increase in trade values between Turkey and its top 10 partners in 5 years, while negative bars indicate decrease in trade relationship. The chart offers a concise overview of Turkey's trade relationship with its key partners, presenting input for further analysis on defining partners that have close relationship with Turkey.*

**Stacked Column Chart: Close Trade Partners (Increasing trend in trade volumes) listed with Product Categories**

```{r message=FALSE,warning=FALSE}
# Filter data for Iraq, Spain, and USA
trade_data_selected_partners<- read_wits_turkey_data_with_partners %>%
  filter(partner_name %in% c("Iraq", "Spain", "USA"))

# Add a new column for total trade
trade_data_selected_partners <- trade_data_selected_partners%>%
  mutate(total_trade = (trade_value_usd_imp + trade_value_usd_exp)/1000000)

# Group by section_name and calculate total trade values for each section_name
total_trade_values_5_year <- trade_data_selected_partners %>%
  filter(year >= 2015 & year <= 2020) %>%
  group_by(section_name, partner_name) %>%
  summarise(total_trade_value = sum(total_trade))

# Filter top 5 section names
filtered_commodity_data <- total_trade_values_5_year %>%
  group_by(partner_name) %>%
  arrange(desc(total_trade_value)) %>%
  slice_head(n=5)

# Truncate section names to the first 20 characters
filtered_commodity_data$truncated_name <- str_trunc(filtered_commodity_data$section_name, 50)

# Stacked Column Chart
ggplot(filtered_commodity_data, aes(x = partner_name, y = total_trade_value, fill = truncated_name)) +
  geom_col() +
  labs(title = "Total Trade Breakdown by Section Name and Partner (2015-2020)",
       x = "Partner Name", y = "Total Trade mn USD",
       fill = "Sections") +
  theme_minimal() +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(nrow = 4))
```

*Chart Description: These pie charts illustrate commodity breakdown data of each country that has close relationship with Turkey which are defined in previous analysis. Iraq, USA and Spain were analyzed in this section. Each pie chart represent share of top 5 commodities in total trade values.*

**Line Chart: Trend Analysis of Exports Value by top 9 product categories**
```{r message=FALSE}
top_export_products <- read_wits_turkey_data_only %>%
  group_by(section_name) %>%
  summarize(total_export = sum(trade_value_usd_exp)) %>%
  na.omit() 
  
top_export_products <- top_export_products %>%
  arrange(desc(total_export))
top_export_products$total_export <- scales::number_format(suffix = "M")(top_export_products$total_export / 1e6)

DT::datatable(top_export_products, colnames = c('Section Name', 'Total Export(USD)'),options = list(pageLength = 9))

```
```{r message=FALSE,warning=FALSE}
top_exports_products <- read_wits_turkey_data_only %>%
  group_by(section_name) %>%
  summarize(total_export = sum(trade_value_usd_exp)) %>%
  top_n(9)%>%
  na.omit() 

top_exports_products <- top_exports_products %>% 
  mutate(
    section_name = case_when(
        str_detect(section_name, "^Machinery and mechanical appliances") ~ "Machinery Products",
      str_detect(section_name, "^Base metals") ~ "Metal Products",
      str_detect(section_name, "^Natural or") ~ "Natural Products",
      str_detect(section_name, "^Vehicles,") ~ "Transport Equipment",
      str_detect(section_name, "^Plastics and articles") ~ "Plastics",
      str_detect(section_name, "^Product of the chemicals") ~ "Chemicals",
      str_detect(section_name, "^Prepared foodstuffs,") ~ "Foodstuffs and Tobacco",
      TRUE ~ as.character(section_name)
    )
  )

read_wits_turkey_data_with_partners_edit <- read_wits_turkey_data_with_partners%>% 
  mutate(
    section_name = case_when(
      str_detect(section_name, "^Machinery and mechanical appliances") ~ "Machinery Products",
      str_detect(section_name, "^Base metals") ~ "Metal Products",
      str_detect(section_name, "^Natural or") ~ "Natural Products",
      str_detect(section_name, "^Vehicles,") ~ "Transport Equipment",
      str_detect(section_name, "^Plastics and articles") ~ "Plastics",
      str_detect(section_name, "^Product of the chemicals") ~ "Chemicals",
      str_detect(section_name, "^Prepared foodstuffs,") ~ "Foodstuffs and Tobacco",
      TRUE ~ as.character(section_name)
    )
  )

# Filter the data with the selected top import products
export_plot_data <- read_wits_turkey_data_with_partners_edit %>%
  filter(section_name %in% top_exports_products$section_name) %>%
  group_by(year, section_name) %>%
  summarize(total_export = sum(trade_value_usd_exp)) %>%
  ungroup()  

# Create the plot with geom_point
ggplot(data = export_plot_data, aes(x = year, y = total_export, color = section_name)) +
  geom_line(size = 1.2) +
  facet_wrap(~section_name, scales = "free_y", ncol = 3, labeller = labeller(NULL)) +
  labs(title = "Export Trends of Top 9 Products (2002-2020, Turkey)", x = "Year", y = "Total Export Value (USD)") +
  theme(legend.position = "none")  # Remove legend
```

*Chart Description: Explore the export trends of Turkey's top 10 product categories from 2002 to 2020. Each line represents a product category, showcasing the variation in total export values over the years. The colors distinguish different product categories, providing a visual overview of their respective export dynamics.*

**Line Chart: Trend Analysis of Global Market Share of Total Exports Value of Turkey in Total Exports by product categories**

```{r message=FALSE,warning=FALSE}
#tba
```

*Chart Description: This chart Turkey's export value in global exports, providing country's presence and strategic importance in commodity markets*

**Line Chart: Trend Analysis of Import Value by top 9 product categories**
```{r message=FALSE}
top_import_products <- read_wits_turkey_data_only %>%
  group_by(section_name) %>%
  summarize(total_import = sum(trade_value_usd_imp)) %>%
  na.omit() 
  
top_import_products <- top_import_products %>%
  arrange(desc(total_import))
top_import_products$total_import <- scales::number_format(suffix = "M")(top_import_products$total_import / 1e6)
datatable(top_import_products, colnames = c('Section Name', 'Total Import(USD)'),options = list(pageLength = 9))

```
```{r message=FALSE}
top_import_products <- read_wits_turkey_data_only %>%
  group_by(section_name) %>%
  summarize(total_import = sum(trade_value_usd_imp)) %>%
  top_n(10)%>%
  na.omit() 

top_import_products <- top_import_products %>% 
  mutate(
    section_name = case_when(
        str_detect(section_name, "^Machinery and mechanical appliances") ~ "Machinery Products",
      str_detect(section_name, "^Base metals") ~ "Metal Products",
      str_detect(section_name, "^Natural or") ~ "Natural Products",
      str_detect(section_name, "^Vehicles,") ~ "Transport Equipment",
      str_detect(section_name, "^Plastics and articles") ~ "Plastics",
      str_detect(section_name, "^Product of the chemicals") ~ "Chemicals",
      TRUE ~ as.character(section_name)
    )
  )

read_wits_turkey_data_with_partners_edit <- read_wits_turkey_data_with_partners%>% 
  mutate(
    section_name = case_when(
      str_detect(section_name, "^Machinery and mechanical appliances") ~ "Machinery Products",
      str_detect(section_name, "^Base metals") ~ "Metal Products",
      str_detect(section_name, "^Natural or") ~ "Natural Products",
      str_detect(section_name, "^Vehicles,") ~ "Transport Equipment",
      str_detect(section_name, "^Plastics and articles") ~ "Plastics",
      str_detect(section_name, "^Product of the chemicals") ~ "Chemicals",
      TRUE ~ as.character(section_name)
    )
  )

# Filter the data with the selected top import products
import_plot_data <- read_wits_turkey_data_with_partners_edit %>%
  filter(section_name %in% top_import_products$section_name) %>%
  group_by(year, section_name) %>%
  summarize(total_import = sum(trade_value_usd_imp)) %>%
  ungroup()  

# Create the plot with geom_point
ggplot(data = import_plot_data, aes(x = year, y = total_import, color = section_name)) +
  geom_line(size = 1.2) +
  facet_wrap(~section_name, scales = "free_y", ncol = 3, labeller = labeller(NULL)) +
  labs(title = "Import Trends of Top 9 Products (2002-2020, Turkey)", x = "Year", y = "Total Import Value (USD)") +
  theme(legend.position = "none")  # Remove legend
```

*Chart Description: Description: Explore the import trends of Turkey's top 10 product categories from 2002 to 2020. Each line represents a product category, showcasing the variation in total import values over the years. The colors distinguish different product categories, providing a visual overview of their respective import dynamics.*

## Step 6: Interpretation and Conclusions

Description: In this final step, interpretations and conclusions are drawn based on the analysis. It's an opportunity to provide insights into the data, make recommendations, and outline potential next steps for further final report and presentation

------------------------------------------------------------------------
